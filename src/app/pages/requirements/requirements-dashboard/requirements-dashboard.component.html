<app-breadcrumb [breadcrumb]="breadcrumb"></app-breadcrumb>

<div class="container-fluid">
  @if(loading) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
  } @else {
    <!-- Cards de Resumen -->
    <div class="row">
      <div class="col-xl-3 col-sm-6">
        <div class="card">
          <div class="card-body d-flex align-items-center">
            <div class="icon-box bg-primary-light rounded me-3">
              <i class="fa-solid fa-clipboard-list fa-lg text-primary"></i>
            </div>
            <div>
              <h2 class="mb-0">{{ stats?.total || 0 }}</h2>
              <span class="text-muted">Total Requerimientos</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-sm-6">
        <div class="card">
          <div class="card-body d-flex align-items-center">
            <div class="icon-box bg-warning-light rounded me-3">
              <i class="fa-solid fa-clock fa-lg text-warning"></i>
            </div>
            <div>
              <h2 class="mb-0">{{ getStatusCount('pending') + getStatusCount('in_review') }}</h2>
              <span class="text-muted">Pendientes</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-sm-6">
        <div class="card">
          <div class="card-body d-flex align-items-center">
            <div class="icon-box bg-info-light rounded me-3">
              <i class="fa-solid fa-spinner fa-lg text-info"></i>
            </div>
            <div>
              <h2 class="mb-0">{{ getStatusCount('in_progress') }}</h2>
              <span class="text-muted">En Progreso</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-sm-6">
        <div class="card">
          <div class="card-body d-flex align-items-center">
            <div class="icon-box bg-success-light rounded me-3">
              <i class="fa-solid fa-check-circle fa-lg text-success"></i>
            </div>
            <div>
              <h2 class="mb-0">{{ getStatusCount('completed') }}</h2>
              <span class="text-muted">Completados</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráficos -->
    <div class="row">
      <!-- Gráfico de Estados -->
      <div class="col-xl-4">
        <div class="card">
          <div class="card-header border-0">
            <h4 class="heading mb-0">Por Estado</h4>
          </div>
          <div class="card-body">
            @if(stats && statusChartOptions.series.length > 0) {
              <apx-chart
                [series]="statusChartOptions.series"
                [chart]="statusChartOptions.chart"
                [labels]="statusChartOptions.labels"
                [colors]="statusChartOptions.colors"
                [legend]="statusChartOptions.legend"
                [dataLabels]="statusChartOptions.dataLabels"
                [plotOptions]="statusChartOptions.plotOptions">
              </apx-chart>
            } @else {
              <p class="text-center text-muted">Sin datos</p>
            }
          </div>
        </div>
      </div>

      <!-- Gráfico de Prioridades -->
      <div class="col-xl-4">
        <div class="card">
          <div class="card-header border-0">
            <h4 class="heading mb-0">Por Prioridad</h4>
          </div>
          <div class="card-body">
            @if(stats && priorityChartOptions.series[0].data.length > 0) {
              <apx-chart
                [series]="priorityChartOptions.series"
                [chart]="priorityChartOptions.chart"
                [colors]="priorityChartOptions.colors"
                [plotOptions]="priorityChartOptions.plotOptions"
                [xaxis]="priorityChartOptions.xaxis"
                [legend]="priorityChartOptions.legend"
                [dataLabels]="priorityChartOptions.dataLabels">
              </apx-chart>
            } @else {
              <p class="text-center text-muted">Sin datos</p>
            }
          </div>
        </div>
      </div>

      <!-- Gráfico de Tipos -->
      <div class="col-xl-4">
        <div class="card">
          <div class="card-header border-0">
            <h4 class="heading mb-0">Por Tipo</h4>
          </div>
          <div class="card-body">
            @if(stats && typeChartOptions.series[0].data.length > 0) {
              <apx-chart
                [series]="typeChartOptions.series"
                [chart]="typeChartOptions.chart"
                [colors]="typeChartOptions.colors"
                [plotOptions]="typeChartOptions.plotOptions"
                [xaxis]="typeChartOptions.xaxis"
                [dataLabels]="typeChartOptions.dataLabels">
              </apx-chart>
            } @else {
              <p class="text-center text-muted">Sin datos</p>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Últimos Requerimientos -->
    <div class="row">
      <div class="col-xl-12">
        <div class="card">
          <div class="card-header border-0 d-flex justify-content-between">
            <h4 class="heading mb-0">Últimos Requerimientos</h4>
            <a routerLink="/admin/requirements" class="btn btn-primary btn-sm">
              Ver todos
            </a>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Código</th>
                    <th>Título</th>
                    <th>Tipo</th>
                    <th>Prioridad</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                  </tr>
                </thead>
                <tbody>
                  @for(item of recentRequirements; track item.id) {
                    <tr>
                      <td>
                        <a [routerLink]="['/admin/requirements', item.id]" class="fw-bold text-primary">
                          {{ item.code }}
                        </a>
                      </td>
                      <td>{{ item.title }}</td>
                      <td>
                        <span class="badge badge-primary light">
                          {{ getTypeLabel(item.type) }}
                        </span>
                      </td>
                      <td>
                        <span class="badge badge-{{ item.priority === 'critical' ? 'danger' : item.priority === 'high' ? 'warning' : 'secondary' }}">
                          {{ getPriorityLabel(item.priority) }}
                        </span>
                      </td>
                      <td>
                        <span class="badge badge-{{ getStatusColor(item.status) }}">
                          {{ getStatusLabel(item.status) }}
                        </span>
                      </td>
                      <td>{{ item.createdAt | date:'dd/MM/yyyy' }}</td>
                    </tr>
                  } @empty {
                    <tr>
                      <td colspan="6" class="text-center py-3 text-muted">
                        No hay requerimientos
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>
